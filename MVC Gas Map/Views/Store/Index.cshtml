@model IEnumerable<MVC_Gas_Map.Models.Store>
@{
    ViewBag.Title = "Trang chủ";

}
<!------>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js" type="text/javascript"></script>
<!------>
<script src="~/Scripts/Control.FullScreen.js"></script>
<link href="~/Content/Control.FullScreen.css" rel="stylesheet" />
<!------>
<script src="~/Scripts/Control.MiniMap.js"></script>
<link href="~/Content/Control.MiniMap.css" rel="stylesheet" />
<!------>
<link href="~/Content/Control.Coordinates-0.1.5.css" rel="stylesheet" />
<script src="~/Scripts/Control.Coordinates-0.1.5.min.js"></script>
<!------>
<script src="~/Scripts/Control.IconLayer.Providers.js"></script>
<script src="~/Scripts/Control.IconLayers.js"></script>
<link href="~/Content/Control.IconLayers.css" rel="stylesheet" />
<!------>
<link href="~/Content/Control.MarkerHighLight.css" rel="stylesheet" />
<script src="~/Scripts/Control.MarkerHighLight.js"></script>
<!------>
<script src="~/Scripts/Control.MakiMarkers.js"></script>
<!------>
<!------>

<style>
    .leaflet-popup-content {
        margin: 15px 25px;
        line-height: 1.4;
    }

    .label {
        display: inline;
        padding: .2em .6em .3em;
        font-size: 75%;
        font-weight: 700;
        line-height: 1;
        color: #656;
        text-align: center;
        white-space: nowrap;
        vertical-align: baseline;
        border-radius: .25em;
    }

    .fullscreen-icon {
        background-image: url('../../Images/icon-fullscreen.png');
    }

    .leaflet-retina .fullscreen-icon {
        background-image: url('../../Images/icon-fullscreen-2x.png');
        background-size: 26px 26px;
    }

    .leaflet-container:-webkit-full-screen {
        width: 100% !important;
        height: 100% !important;
        z-index: 99999;
    }

    .leaflet-container:-ms-fullscreen {
        width: 100% !important;
        height: 100% !important;
        z-index: 99999;
    }

    .leaflet-container:full-screen {
        width: 100% !important;
        height: 100% !important;
        z-index: 99999;
    }

    .leaflet-container:fullscreen {
        width: 100% !important;
        height: 100% !important;
        z-index: 99999;
    }

    .leaflet-pseudo-fullscreen {
        position: fixed !important;
        width: 100% !important;
        height: 100% !important;
        top: 0px !important;
        left: 0px !important;
        z-index: 99999;
    }

    #idGasMap {
        width: 100%;
        height: 600px;
    }

    .map-popup-content {
        width: 260px;
    }

        .map-popup-content .left {
            float: left;
            width: 45%;
        }

            .map-popup-content .left img {
                width: 100%;
                height: 100px;
                margin: -15px 0 -15px -20px;
                border-radius: 12px;
            }

        .map-popup-content .right {
            float: left;
            width: 55%;
        }

    .clearfix {
        clear: both;
    }

    .toggle {
        background: orange !important;
    }

        .toggle:hover {
            background: darkorange !important;
        }


    .marker-pin {
        width: 30px;
        height: 30px;
        border-radius: 50% 50% 50% 0;
        background: #c30b82;
        position: absolute;
        transform: rotate(-45deg);
        left: 50%;
        top: 50%;
        margin: -15px 0 0 -15px;
    }

        .marker-pin::after {
            content: '';
            width: 24px;
            height: 24px;
            margin: 3px 0 0 3px;
            background: #fff;
            position: absolute;
            border-radius: 50%;
        }

    .custom-div-icon i {
        position: absolute;
        width: 22px;
        font-size: 22px;
        left: 0;
        right: 0;
        margin: 10px auto;
        text-align: center;
    }

        .custom-div-icon i.awesome {
            margin: 12px auto;
            font-size: 17px;
        }
</style>

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800"><i class="glyphicon glyphicon-home" style="color:#ca4d1f;font-size:19px;"></i>  <span style="font-weight: 500;font-size: initial;font-family: sans-serif;font-size:18px;">Bản đồ cửa hàng gas</span></h1>
    <button onclick="goToCurrentLocation()" class="h3 mb-0 btn btn-default" style="background-color:#fdecec;"><i class="glyphicon glyphicon-tags mr-1 mt-1" style="color:#ca4d1f;font-size:19px;"></i>   <span style="font-weight: 500;font-size: initial;font-family: sans-serif;font-size:18px;">Vị trí của bạn</span></button>
</div>
<div class="@*container body-content*@" style="margin-top:0.1rem;">
    <div id="idGasMap"></div>
    <hr />
</div>
<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4" id="IntroSection">
    <h1 class="h3 mb-0 text-gray-800">Đôi nét về chúng tôi</h1>
    @*<a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>*@
</div>
<!-- Content Row -->
<div class="row">
    <!-- Earnings (Monthly) Card Example -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-primary shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">Số lượng cửa hàng gas đối tác</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800"><p id="amountOfStores"></p></div>
                    </div>
                    <div class="col-auto">
                        <i class="fa fa-home fa-4x" style="color:#ff6666"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Earnings (Monthly) Card Example -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-success shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Số lượng người đăng kí tài khoản của website tính đến 18/5/2020</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800"><p id="amountOfUsers"></p></div>
                    </div>
                    <div class="col-auto">
                        <i class="fa fa fa-group fa-4x" style="color:#537fce"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Earnings (Monthly) Card Example -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-info shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Điểm hài lòng của khách hàng với dịch vụ của chúng tôi</div>
                        <div class="col h5 mb-0 mr-3 font-weight-bold text-gray-800">
                            <div class="col-sm-3">9 / 10</div>
                            <div class=" progress progress-sm" title="Điểm hài lòng: 9 / 10" style="height:1.2rem;margin-bottom:0;">
                                <div class="progress-bar bg-info" role="progressbar" style="width: 90%"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Pending Requests Card Example -->
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="card border-left-warning shadow h-100 py-2">
            <div class="card-body">
                <div class="row no-gutters align-items-center">
                    <div class="col mr-2">
                        <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Số lượng dịch vụ đã cung cấp thành công</div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">100</div>
                    </div>
                    <div class="col-auto">
                        <i class="fa fa-handshake-o fa-4x" style="color:#ca45ca"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Content Row -->
<div class="row">
    <!-- Area Chart -->
    <div class="col-xl-8 col-lg-7">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Earnings Overview</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                        <div class="dropdown-header">Dropdown Header:</div>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </div>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-area">
                    <canvas id="myAreaChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <!-- Pie Chart -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Cổ phần công ty chúng tôi</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in" aria-labelledby="dropdownMenuLink">
                        <div class="dropdown-header">Dropdown Header:</div>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </div>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <div class="chart-pie pt-4 pb-2">
                    <canvas id="myPieChart"></canvas>
                </div>
                <div class="mt-4 text-center small">
                    <span class="mr-2 text-uppercase fa-2x">
                        <i class="fa fa-circle text-primary"></i> Huy
                    </span>
                    <span class="mr-2 text-uppercase fa-2x">
                        <i class="fa fa-circle text-success"></i> Thắng
                    </span>
                    <span class="mr-2 text-uppercase fa-2x">
                        <i class="fa fa-circle text-info"></i> Nhạ
                    </span>
                    <span class="mr-2 text-uppercase fa-2x">
                        <i class="fa fa-circle text-warning"></i> Đại
                    </span>
                    <span class="mr-2 text-uppercase fa-2x">
                        <i class="fa fa-circle" style="color:red;"></i> Kiên
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Content Row -->
<div class="row">
    <!-- Content Column -->
    <div class="col-lg-6 mb-4">
        <!-- Project Card Example -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Projects</h6>
            </div>
            <div class="card-body">
                <h4 class="small font-weight-bold">Server Migration <span class="float-right">20%</span></h4>
                <div class="progress mb-4">
                    <div class="progress-bar bg-danger" role="progressbar" style="width: 20%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <h4 class="small font-weight-bold">Sales Tracking <span class="float-right">40%</span></h4>
                <div class="progress mb-4">
                    <div class="progress-bar bg-warning" role="progressbar" style="width: 40%" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <h4 class="small font-weight-bold">Customer Database <span class="float-right">60%</span></h4>
                <div class="progress mb-4">
                    <div class="progress-bar" role="progressbar" style="width: 60%" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <h4 class="small font-weight-bold">Payout Details <span class="float-right">80%</span></h4>
                <div class="progress mb-4">
                    <div class="progress-bar bg-info" role="progressbar" style="width: 80%" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <h4 class="small font-weight-bold">Account Setup <span class="float-right">Complete!</span></h4>
                <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
            </div>
        </div>
        <!-- Color System -->
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card bg-primary text-white shadow">
                    <div class="card-body">
                        Primary
                        <div class="text-white-50 small">#4e73df</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card bg-success text-white shadow">
                    <div class="card-body">
                        Success
                        <div class="text-white-50 small">#1cc88a</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card bg-info text-white shadow">
                    <div class="card-body">
                        Info
                        <div class="text-white-50 small">#36b9cc</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card bg-warning text-white shadow">
                    <div class="card-body">
                        Warning
                        <div class="text-white-50 small">#f6c23e</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card bg-danger text-white shadow">
                    <div class="card-body">
                        Danger
                        <div class="text-white-50 small">#e74a3b</div>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card bg-secondary text-white shadow">
                    <div class="card-body">
                        Secondary
                        <div class="text-white-50 small">#858796</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-6 mb-4">
        <!-- Illustrations -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Illustrations</h6>
            </div>
            <div class="card-body">
                <div class="text-center">
                    @*  <img class="img-fluid px-3 px-sm-4 mt-3 mb-4" style="width: 25rem;" src="img/undraw_posting_photo.svg" alt="">*@
                </div>
                <p>Add some quality, svg illustrations to your project courtesy of <a target="_blank" rel="nofollow" href="https://undraw.co/">unDraw</a>, a constantly updated collection of beautiful svg images that you can use completely free and without attribution!</p>
                <a target="_blank" rel="nofollow" href="https://undraw.co/">Browse Illustrations on unDraw &rarr;</a>
            </div>
        </div>
        <!-- Approach -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Development Approach</h6>
            </div>
            <div class="card-body">
                <p>SB Admin 2 makes extensive use of Bootstrap 4 utility classes in order to reduce CSS bloat and poor page performance. Custom CSS classes are used to create custom components and custom utility classes.</p>
                <p class="mb-0">Before working with this theme, you should become familiar with the Bootstrap framework, especially the utility classes.</p>
            </div>
        </div>
    </div>
</div>




<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="row">
                    <div class="col-sm-11">
                        <h4 class="modal-title" style="font-size: 20px;" id="exampleModalLabel"></h4>
                    </div>
                    <div class="col-sm-1">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" style="font-size:30px;">&times;</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Tên phòng:</label>
                        <input type="text" class="form-control" id="mapName" required>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Số điện thoại:</label>
                        <input type="text" class="form-control" id="phoneNumber" required>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Địa chỉ:</label>
                        <input type="text" class="form-control" id="address" required>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Tiền thuê:</label>
                        <input type="text" class="form-control" id="moneyEachMonth" required>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Diện tích phòng:</label>
                        <input type="text" class="form-control" id="acreageRoom" required>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Chi tiết phòng:</label>
                        <input type="text" class="form-control" id="descriptionDetail" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="addRoom()">Tạo phòng</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Thoát</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="exampleModal1" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <div class="row">
                    <div class="col-sm-11">
                        <h4 class="modal-title" style="font-size: 20px;" id="exampleModalLabel1"></h4>
                    </div>
                    <div class="col-sm-1">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true" style="font-size:30px;">&times;</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="col-form-label">Tên phòng:</label>
                        <input type="text" class="form-control" id="mapName1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Số điện thoại:</label>
                        <input type="text" class="form-control" id="phoneNumber1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Địa chỉ:</label>
                        <input type="text" class="form-control" id="address1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Tiền thuê:</label>
                        <input type="text" class="form-control" id="moneyEachMonth1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Diện tích phòng:</label>
                        <input type="text" class="form-control" id="acreageRoom1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="col-form-label">Chi tiết phòng:</label>
                        <input type="text" class="form-control" id="descriptionDetail1" disabled>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Thoát</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Variable
    var lat = null;
    var long = null;
    var popupContent = null;
    var defaultCoord = null;
    var mapObj = null;
    var marker;
    var zoomLevel = 15;
    var minimap = null;
    var flagMarkerCurLocation = false;
    //var amountOfStos = null;
    var url = new URL(document.URL);
    var search_params = url.searchParams;
    var markerGroup = null;
    var popup = L.popup();

    var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var osmAttrib = 'Có làm mới có ăn !!! ';
    var osm = new L.TileLayer(osmUrl, { minZoom: 5, maxZoom: 18, attribution: osmAttrib });
    var osm2 = new L.TileLayer(osmUrl, { minZoom: 0, maxZoom: 13, attribution: osmAttrib });
    ///////////////////
    //L.MakiMarkers.accessToken = 'pk.eyJ1IjoiZDNwemExMm81IiwiYSI6ImNrOWljamZqczE4M2EzcHFiY3NoZms2ZTYifQ.lhpwFvZyHvEy5fZFBBhXxw';


    //if (!search_params.has('lat') || !search_params.has('lng')) {
    //    defaultCoord = [21.061540, 105.781103];//toạ độ mặc địNH Ở PHẠM VĂN ĐỒNG
    //}
    //else {
    //    var latId = search_params.get('lat');
    //    var lngId = search_params.get('lng');
    //    defaultCoord = [latId, lngId];
    //}



    // Window load

    window.onload = function () {
        $("#introProject").show();

        if (typeof (Storage) !== "undefined") {
            var curLocation = localStorage.getItem("curLocation");
            if (curLocation != null) {
                flagMarkerCurLocation = true;
                var latAndLng = curLocation.split(",");
                defaultCoord = [Number(latAndLng[0]), Number(latAndLng[1])];
            }
        }
        else {
            console.log("pohip");
        }


        if (defaultCoord == null) {
            defaultCoord = [21.061540, 105.781103];//toạ độ mặc địNH Ở PHẠM VĂN ĐỒNG
        }
        var mapConfig = {
            attributionControl: true, // hiện watermark
            center: defaultCoord, // vị trí map mặc định hiện tại
            zoom: zoomLevel, // level zoom
            fullscreenControl: true,
            fullscreenControlOptions: {
                position: 'topleft'
            }
        };


        mapObj = new L.map('idGasMap', mapConfig);

        mapObj.addLayer(osm);


        //
        L.control.coordinates({
            position: "bottomleft",
            decimals: 0, //optional default 4
            decimalSeperator: ".", //optional default "."
            labelTemplateLat: "Latitude: {y}", //optional default "Lat: {y}"
            labelTemplateLng: "Longitude: {x}", //optional default "Lng: {x}"
            enableUserInput: true, //optional default true
            useDMS: false, //optional default false
            useLatLngOrder: true, //ordering of labels, default false-> lng-lat
            markerType: L.marker, //optional default L.marker
            markerProps: {} //optional default {}
        }).addTo(mapObj);

        mapObj.on('click', onMapClick);

        var layerGroup = new L.layerGroup([osm2]);
        minimap = new L.Control.MiniMap(layerGroup, { toggleDisplay: true }).addTo(mapObj);


        getAllStoresInDb();
        markerGroup = L.layerGroup().addTo(mapObj);
        //////////////
        if (this.flagMarkerCurLocation)
            setMarkerCurrentLocation(defaultCoord)
        ///////////////////


        ///
        var layers = [];
        for (var providerId in providers) {
            layers.push(providers[providerId]);
        }

        layers.push({
            layer: {
                onAdd: function () { },
                onRemove: function () { }
            },
            title: 'empty'
        })

        var ctrl = L.control.iconLayers(layers).addTo(mapObj);
        setInterval(function () {
            markerGroup.clearLayers();
            getAllStoresInDb();
        }, 500000)
    };
    ///////////////////

    function setMarkerCurrentLocation(defaultCoord) {
        const locationIcon = L.MakiMarkers.icon({
            // icon: "beer",
            icon: "star-stroked",
            color: "#13a",
            size: "xl"
        });

        marker = new L.marker(defaultCoord, { icon: locationIcon });

        marker.options.highlight = "permanent";
        mapObj.markers = marker;
        var popup = L.popup();
        popup.setContent("<span>Đây là vị trí của bạn </span>");

        // binding
        marker.bindPopup(popup);
        marker.addTo(markerGroup);
    }

    function addMarkerCircleInMiniMap(lat, long, layerGroup) {
        var myCircle = new L.CircleMarker(new L.LatLng(lat, long), { radius: 2 });
        layerGroup = layerGroup.addLayer(myCircle)
        return layerGroup;
    }

    function addMarker(coord, popupContent, popupOptionObj, markerObj) {
        if (!popupOptionObj) {
            popupOptionObj = {};
        }
        //var icon = L.divIcon({
        //    className: 'custom-div-icon',
        //    html: "<div style='background-color:#c30b82;' class='marker-pin'></div><i class='fa fa-camera awesome'></i>",
        //    iconSize: [30, 42],
        //    iconAnchor: [15, 42]
        //});
        const storeIcon = L.MakiMarkers.icon({
            //icon: "beer",
            icon: "building",
            color: "#12a",
            size: "l"
        });

        marker = new L.marker(coord, { icon: storeIcon });

        //console.log(marker);

        marker.options.highlight = "permanent";
        //marker.addTo(mapObj);
        mapObj.markers = marker;
        var popup = L.popup(popupOptionObj);
        popup.setContent(popupContent);

        // binding
        marker.bindPopup(popup);
        marker.addTo(markerGroup);

    }

    function onMapClick(e) {
        long = e.latlng.lng.toFixed(5);//lấy giá trị long
        lat = e.latlng.lat.toFixed(5);//lấy giá trị lat
        var html = `<h4>Toạ độ (` + lat + `,` + long + `)</h4>
        <button class="btn btn-primary" data-toggle="modal" data-target="#exampleModal" onclick="showPopUp()"><i class="glyphicon glyphicon-plus"></i> Tạo phòng </button>`;
        popup
            .setLatLng(e.latlng)
            .setContent(html)
            .openOn(mapObj);//hiện popup
        //console.log(e.latlng);
    }
    //
    function screenFull(map) {
        L.control.fullscreen({
            position: 'topleft', // change the position of the button can be topleft, topright, bottomright or bottomleft, defaut topleft
            title: 'Show me the fullscreen !', // change the title of the button, default Full Screen
            titleCancel: 'Exit fullscreen mode', // change the title of the button when fullscreen is on, default Exit Full Screen
            content: null, // change the content of the button, can be HTML, default null
            forceSeparateButton: true, // force seperate button to detach from zoom buttons, default false
            forcePseudoFullscreen: true, // force use of pseudo full screen even if full screen API is available, default false
            fullscreenElement: false // Dom element to render in full screen, false by default, fallback to map._container
        }).addTo(map);
    }


    function getAllStoresInDb() {
        var popupContent = null;
        var popupOption = {
            className: "map-popup-content",
        };


        $.ajax({
            type: 'get',
            url: '/Store/getAllStores',
            dataType: 'json',
            contentType: 'application/json; charset=utf-8',
            beforeSend: function () {
                $(".loader").show();
            },
            success: function (data) {
                if (1 == 1) {
                    var name = null;
                    var layerGroup = new L.layerGroup([osm2]);
                    var responsive = data.data;
                    //console.log(responsive.length);
                    for (let i = 0; i < responsive.length; i++) {
                        if (responsive[i].StoreName == null) {
                            name = `Cửa hàng gas`;
                        } else {
                            name = responsive[i].StoreName;
                        }

                        popupContent = `<div class='left'><img src="/Images/buy-vector-flat-4.png" width="100%" /></div>`;
                        popupContent += `<div class='right'><h5>${name}</h5><br>`;
                        popupContent += `<button class="btn btn-primary" data-toggle="modal" data-target="#exampleModal1" onclick="showPopUpDetailStore('${responsive[i].StoreID}')">
                        <i class="glyphicon glyphicon-eye-open"></i>
                        Xem chi tiết
                        </button></div>`;
                        popupContent += `<div class='clearfix'></div>`;

                        addMarker([Number(responsive[i].Latitude), Number(responsive[i].Longitude)], popupContent, popupOption);
                        layerGroup = addMarkerCircleInMiniMap(Number(responsive[i].Latitude), Number(responsive[i].Longitude), layerGroup);
                    }
                    //var miniMap = new L.Control.MiniMap(layerGroup, { toggleDisplay: true }).addTo(mapObj);
                    minimap.changeLayer(layerGroup);

                }
            }
        })
        $(".loader").hide();
    }


    function showPopUp() {
        var str = `Tạo phòng ở toạ độ (${lat},${long})`;
        $('#exampleModalLabel').text(str);
    }

    function addRoom() {
        var url = `/Points/Main?lat=${lat}&lng=${long}`;

        var mapName = $('#mapName').val();//HẢI BÉO
        var phoneNumber = $('#phoneNumber').val();
        var address = $('#address').val();
        var moneyEachMonth = $('#moneyEachMonth').val();
        var acreageRoom = $('#acreageRoom').val();
        var descriptionDetail = $('#descriptionDetail').val();

        var parameters = `{MapName: '${mapName}',Latitude:'${lat}',Longitude:'${long}',
                          PhoneNumber:'${phoneNumber}',
                          Address:'${address}',
                          MoneyEachMonth:'${moneyEachMonth}',
                          AcreageRoom:'${acreageRoom}',
                          DescriptionDetail:'${descriptionDetail}'}`;//tạo string


        $.ajax({
            type: 'POST',
            url: '/Points/Save',
            dataType: 'JSON',
            contentType: 'application/json; charset=utf-8',
            data: parameters,
            success: function (data) {
                if (1 == 1) {
                    alert("Tạo phòng trọ thành công");
                    $(location).attr('href', url);//chuyển url
                }
            }

        })
    }

    function showPopUpDetailStore(storeId) {

        $.ajax({
            type: 'POST',
            url: '/Store/getDetailStore?storeId=' + storeId,
            dataType: 'JSON',
            success: function (data) {
                if (1 === 1) {
                    var responsive = data.data;
                    if (responsive.length == 1) {
                        //alert('Success')
                        //$('#mapName1').val(data[0].mapName);
                        //$('#phoneNumber1').val(data[0].phoneNumber);
                        //$('#address1').val(data[0].address);
                        //$('#moneyEachMonth1').val(data[0].moneyEachMonth);
                        //$('#acreageRoom1').val(data[0].acreageRoom);
                        //$('#descriptionDetail1').val(data[0].descriptionDetail);
                    }
                }

            }
        })

        var str = `Chi tiết `;
        $('#exampleModalLabel1').text(str);
    }


</script>

<script>

    getDataForCardInFormIndex();

    function getDataForCardInFormIndex() 
    {
        var amountOfStos =@ViewBag.AmountOfStores;
        $('#amountOfStores').html(amountOfStos);

        var amountOfUsers =@ViewBag.AmountOfUsers;
        $('#amountOfUsers').html(amountOfUsers);
    }

    function goToCurrentLocation()
    {
        navigator.geolocation.getCurrentPosition
            (
            function (location)
            {
                var currentLocation = new L.LatLng(location.coords.latitude, location.coords.longitude);
                mapObj.setView(currentLocation, zoomLevel);
                var curLocation = [location.coords.latitude, location.coords.longitude];
                markerGroup.clearLayers();
                setMarkerCurrentLocation(curLocation);
                getAllStoresInDb();
                localStorage.removeItem("curLocation");
                localStorage.setItem("curLocation", curLocation);
            });

    }
</script>

<script src="~/Scripts/Charts/Chart.min.js"></script>
<script src="~/Scripts/Charts/chart-area-demo.js"></script>
<script src="~/Scripts/Charts/chart-pie-demo.js"></script>
